---
title: "webhacking.kr 4ë²ˆ ë¬¸ì œ"
date: 2019-10-14
excerpt: "sha1 í•´ì‰¬í•¨ìˆ˜ì™€ ë ˆì¸ë³´ìš° í…Œì´ë¸”"
categories : "webhacking"
comments: true
header:
    image: /assets/images/webhacking04image.jpg
    teaser: "https://raw.githubusercontent.com/TERADA-DANTE/TERADA-DANTE.github.io/master/_images/teaser/webhacking_teaser.jpg"
toc: true 
toc_label: "ì´ë²ˆ í¬ìŠ¤íŠ¸ì—ì„œëŠ” ..." 
toc_icon: "chess-rook"
toc_sticky: true
---

## ê°œìš”
ëˆ„êµ¬ë‚˜ í•œ ë²ˆì¯¤ì€ 4ìë¦¬ ìˆ«ìì•”í˜¸ë¥¼ ìŠì–´ë²„ë ¤ì„œ 0000ë¶€í„° 9999ê¹Œì§€ ì¼ì¼íˆ ì•”í˜¸ë¥¼ í’€ê¸°ìœ„í•œ ì‹œë„ë¥¼ í•´ë³¸ ì ì´ ìˆì„ ê²ƒì…ë‹ˆë‹¤. ì–´ì©Œë©´ ì´ë²ˆ í¬ìŠ¤íŠ¸ì˜ í’€ì´ëŠ” ê·¸ ê³¼ì •ê³¼ í¬ê²Œ ë‹¤ë¥´ì§€ ì•Šì„ì§€ë„ ëª¨ë¦…ë‹ˆë‹¤.

ì´ë²ˆ í¬ìŠ¤íŠ¸ëŠ” webhacking.kr 4ë²ˆë¬¸ì œì— ê´€í•œ ê²ƒì…ë‹ˆë‹¤. ë°°ì ì€ 300ì ì…ë‹ˆë‹¤.

4ë²ˆ ë¬¸ì œì˜ ì²« í˜ì´ì§€ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.
![4_1](https://i.imgur.com/cIMTbsn.png)

ê¸€ììˆ˜ 40ìì˜ ë¬¸ìì—´ í•˜ë‹¨ì— Passwordë¥¼ ì œì¶œí•˜ëŠ” formì´ ìˆìŠµë‹ˆë‹¤.

ì´ë²ˆ ë¬¸ì œì˜ ëª©í‘œëŠ” **ì˜¬ë°”ë¥¸ Passwordë¥¼ ì œì¶œí•˜ëŠ” ê²ƒ**ì…ë‹ˆë‹¤.

View-sourceë¥¼ í†µí•´ í™•ì¸í•œ ì†ŒìŠ¤ì½”ë“œëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

`view-source`
~~~php
...
sleep(1); // Brute force attack ë°©ì§€
if((isset($_SESSION['chall4'])) 
&& ($_POST['key'] == $_SESSION['chall4'])) 
solve(4);

$hash = rand(10000000,99999999)."salt_for_you";
$_SESSION['chall4'] = $hash;
for($i=0;$i<500;$i++) $hash = sha1($hash);
...
<?=$hash?> //í˜ì´ì§€ì— $hash ì¶œë ¥
...
~~~
ìœ„ ë¬¸ì œì—ì„œëŠ” `$hash`, `sha1()`ê°€ í’€ì´ì˜ ì¤‘ìš”í•œ Keyê°€ ë  ê²ƒìœ¼ë¡œ ë³´ì…ë‹ˆë‹¤. ë˜í•œ í’€ì´ ê³¼ì •ì—ì„œ `Python`ì´ ì‚¬ìš©ë˜ë¯€ë¡œ ê°„ë‹¨í•œ `Python`ì— ëŒ€í•œ ì´í•´ê°€ í•„ìš”í•©ë‹ˆë‹¤.

## ë¶„ì„
### sleep()
<a class="PHP">PHP</a><a class="PHPver">7.0</a>

sleep() í•¨ìˆ˜ëŠ” ì…ë ¥ëœ **ì´ˆ** ë§Œí¼ php ì½”ë“œì˜ ì‹¤í–‰ì„ ì§€ì—°ì‹œí‚µë‹ˆë‹¤. ì¶”ê°€ë¡œ usleep() í•¨ìˆ˜ ë˜í•œ sleep() í•¨ìˆ˜ì™€ ë™ì¼í•˜ì§€ë§Œ ì…ë ¥ê°’ì„ **ë§ˆì´í¬ë¡œì´ˆ**ë¡œ ë°›ìŠµë‹ˆë‹¤. 
#### sleep() ë¬¸ë²•
~~~php
sleep(int $sec);
~~~
`$sec`: ì§€ì—°ì‹œí‚¬ ì‹œê°„[ì´ˆ]
#### sleep() ì˜ˆì œ
~~~php
sleep(1);               // 1ì´ˆí›„ line 2 ì‹¤í–‰ 
echo ("hello world!");      
~~~
### isset()
<a class="PHP">PHP</a><a class="PHPver">7.0</a>

isset() í•¨ìˆ˜ëŠ” **ë³€ìˆ˜ê°€ ì„ ì–¸ë˜ì—ˆê³ , nullì´ ì•„ë‹˜ì„ íŒì •**í•©ë‹ˆë‹¤.
#### isset() ë¬¸ë²•
~~~php
isset ( mixed $var [, mixed $... ] );
~~~
`mixed`: ìë£Œí˜•ì˜ ì œí•œì´ ì—†ìŒì„ ëœ»í•©ë‹ˆë‹¤.[^1]
#### issset() ì˜ˆì œ
~~~php
  $_str = "1";
  if (isset($_str)){
    echo "isset returned true!";  
  }      // isset returned true!
  $_val; 
  if (isset($_val)){
    echo "Nothing because isset returned false!";
  }      //ì¶œë ¥ ì—†ìŒ
~~~
__*line 6*__: ë³€ìˆ˜ê°€ ì„ ì–¸ë˜ì—ˆì§€ë§Œ nullì´ë¯€ë¡œ false.

### rand()
<a class="PHP">PHP</a><a class="PHPver">7.0</a>

rand() í•¨ìˆ˜ëŠ” ì„ì˜ì˜ ì •ìˆ˜(integer)ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.

#### rand() ë¬¸ë²•
~~~php
rand ( void );
rand ( int $min , int $max );
~~~
`void` : 0 ê³¼ getrandmax() ì‚¬ì´ì˜ ì„ì˜ì˜ ìˆ˜ ë°˜í™˜

`$min`, `$max` : $minê³¼ $max ì‚¬ì´(**í¬í•¨**)ì˜ ì„ì˜ì˜ ìˆ˜ ë°˜í™˜
#### rand() ì˜ˆì œ
~~~php
echo rand();        // 305671403
echo rand(1, 10);   // 3
~~~

### sha1()
<a class="PHP">PHP</a><a class="PHPver">7.0</a>

sha1() í•¨ìˆ˜ëŠ” **ë¬¸ìì—´**ì˜ sha1 hash ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.[^2]
#### sha1() ë¬¸ë²•
~~~php
sha1 ( string $str [, bool $raw_output = FALSE ] );
~~~
`$str`: ì…ë ¥ ë¬¸ìì—´

`$raw_output`: ê¸°ë³¸ê°’ false, 40ì hexademical number ë°˜í™˜.
#### sha1() ì˜ˆì œ
~~~php
  $str="If every body has a ocean";
  echo sha1 ($str);         
  // 5dbfaaf741c3ddb3a6c90f638014b9a13088576d
  $str2="across the USA";
  ech sha1 ($str, true);
  // ]ï¿½ï¿½ï¿½Aï¿½İ³ï¿½ï¿½cï¿½ï¿½ï¿½0ï¿½Wm
~~~
## í’€ì´
`view-source`ì˜ ì½”ë“œëŠ” ë‹¤ìŒê³¼ ê°™ì´ í•´ì„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
~~~php
if((isset($_SESSION['chall4']))  
// $_SESSION['chall4']ê°€ ì¡´ì¬í•˜ê³ 
&&                               
// ê·¸ë¦¬ê³ 
($_POST['key'] == $_SESSION['chall4'])) 
// $_POST['key']ì™€ $_SESSION['chall4'])ê°€ ê°™ë‹¤ë©´
solve(4);
// 4ë²ˆ ë¬¸ì œ í´ë¦¬ì–´!

$hash = rand(10000000,99999999)."salt_for_you";
// 10000000~99999999ì‚¬ì´ì˜ ì„ì˜ì˜ ìˆ˜ì™€ 
// "salt_for_you"ë¼ëŠ” ë¬¸ìì—´ì„ í•©í•˜ì—¬ 
// $hashë¼ê³  ì •ì˜í•˜ê³  (i.e. 10215484salt_for_you)
$_SESSION['chall4'] = $hash;
// $_SESSION['chall4']ì˜ ê°’ì„ ê·¸ $hash ë¡œ ì €ì¥í•œë‹¤.
for($i=0;$i<500;$i++) $hash = sha1($hash);
// $hash ê°’ì€ 500ë²ˆ sha1 hash ë§¤í•‘í•œ í›„,
...
<?=$hash?> 
//ê·¸ ê°’($hash)ì„ í˜ì´ì§€ì— ì¶œë ¥í•œë‹¤.
...
~~~
ì´ë¡œì¨ 
1. í˜ì´ì§€ì— í‘œì‹œë˜ëŠ” 40ìì˜ ë¬¸ìì—´ì€ 500íšŒ sha1 hash ë§¤í•‘ëœ ë¬¸ìì—´ì´ë‹¤.
2. $_SESSION['chall4'] ì—ëŠ” ì •í™•í•œ ê°’ì€ ëª¨ë¥´ì§€ë§Œ `"10000000~99999999ì‚¬ì´ì˜ ê°’salt_for_you"`ë¼ëŠ” ë¬¸ìì—´ì´ ë“¤ì–´ìˆë‹¤.
3. ìš°ë¦¬ëŠ” `$_SESSION['chall4']`ì˜ ì •í™•í•œ ë¬¸ìì—´ì„ ì•Œì•„ë‚´ì–´ `key`ì— ì…ë ¥í•˜ë©´ ë¬¸ì œê°€ í•´ê²°ëœë‹¤.

ë¼ëŠ” ì‚¬ì‹¤ì„ ì•Œì•˜ìŠµë‹ˆë‹¤.

line 1ì˜ isset(\$_SESSION)ì€ ì‚¬ì´íŠ¸ì— ë¡œê·¸ì¸í•˜ì—¬ ë¸Œë¼ìš°ì €ë¥¼ í†µí•´ ë¬¸ì œë¥¼ í•´ê²°í•˜ê³  ìˆë‹¤ë©´ í•­ìƒ ì°¸ì´ë¯€ë¡œ ì‹ ê²½ì“¸ í•„ìš”ëŠ” ì—†ìŠµë‹ˆë‹¤. ê²°êµ­ ë¬¸ì œëŠ” 
> **`$_SESSION['chall4']`ì˜ ê°’ì„ ì–´ë–»ê²Œ ì•Œì•„ë‚¼ ê²ƒì¸ê°€?** 

ë¼ëŠ” ì˜ë¬¸ìœ¼ë¡œ ê·€ê²°ë©ë‹ˆë‹¤.

ìš°ë¦¬ê°€ ê°€ì§€ê³  ìˆëŠ” ìœ ì¼í•œ íŒíŠ¸ëŠ” í˜ì´ì§€ì— í‘œì‹œë˜ëŠ” **500ë²ˆ sha1 hash ë§¤í•‘ëœ 40ìì˜ ë¬¸ìì—´**ì…ë‹ˆë‹¤. ê·¸ë ‡ë‹¤ë©´ ì´ë¥¼ ë°˜ëŒ€ë¡œ 500ë²ˆ decrypt(ë³µí˜¸í™”)í•˜ì—¬ ì›ë³¸ì„ ì•Œì•„ë‚´ë©´ ë ê¹Œìš”? 

**ì•„ë‹™ë‹ˆë‹¤.** ì—¬ê¸°ì— í•œ ê°€ì§€ ì¤‘ìš”í•œ ì‚¬ì‹¤ì´ ìˆìŠµë‹ˆë‹¤. sha1ì€ **ë‹¨ë°©í–¥ í•´ì‹œí•¨ìˆ˜**ë¡œ, ì¶œë ¥ê²°ê³¼ë¥¼ ê°€ì§€ê³  ì›ë³¸ì„ ì–»ëŠ” ê²ƒì´ **ë¶ˆê°€ëŠ¥**í•©ë‹ˆë‹¤. ì˜ˆë¥¼ë“¤ì–´ 
**"6de6a176f51191fba575e1725a01a02bf6e14fcc"** ë¥¼ ì–´ë– í•œ ë°ì´í„° ì²˜ë¦¬ë¥¼ í†µí•´ ì´ê²ƒì€ "10000004salt_for_you"ë¥¼ 500íšŒ ë§¤í•‘í•œ ê²°ê³¼ë‹¤! í˜¹ì€ "51235487salt_for_you"ë¥¼ 500íšŒ ë§¤í•‘í•œ ê²°ê³¼ë‹¤! ë¼ê³  í™•ì¸ í•  ìˆ˜ê°€ ì—†ë‹¤ëŠ” ê²ƒì…ë‹ˆë‹¤. 

ì¦‰ ìš°ë¦¬ëŠ” ë‹¤ìŒê³¼ ê°™ì€ ìƒí™©ì— ìˆìŠµë‹ˆë‹¤.
![4_2](https://i.imgur.com/BDJcexU.png)
í˜ì´ì§€ì—ëŠ” HASH ê·¸ë£¹(B)ê°€ ì¶œë ¥ì´ ë˜ì—ˆê³ , Bì— í•´ë‹¹í•˜ëŠ” 
ì›ë³¸ê·¸ë£¹(A)ëŠ” ë°˜ë“œì‹œ ì¡´ì¬í•©ë‹ˆë‹¤.

ì—¬ê¸°ì„œ `ë ˆì¸ë³´ìš° í…Œì´ë¸”`ì„ ë– ì˜¬ë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤. [ë ˆì¸ë³´ìš° í…Œì´ë¸”](https://ko.wikipedia.org/wiki/%EB%A0%88%EC%9D%B8%EB%B3%B4_%ED%85%8C%EC%9D%B4%EB%B8%94)ì€ ì‰½ê²Œë§í•´ì„œ HASH ê²°ê³¼ì— ëŒ€í•œ **ì‚¬ìš©ì ì‚¬ì „** ì…ë‹ˆë‹¤. 

ìš°ë¦¬ëŠ” ëª¨ë¥´ëŠ” ë‹¨ì–´ê°€ ìˆì„ ë•Œ, ì‚¬ì „ì„ ë“¤ì¶°ë³´ë©´ ê·¸ ë‹¨ì–´ì— í•´ë‹¹í•˜ëŠ” ì˜ë¯¸ë¥¼ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì‚¬ì „ì—ëŠ” ì´ë¯¸ ìˆ˜ë§ì€ ë‹¨ì–´ë“¤ì˜ ì˜ë¯¸ê°€ ë“¤ì–´ìˆê¸° ë•Œë¬¸ì…ë‹ˆë‹¤. ì˜ë¯¸ë¥¼ ì›ë³¸ê·¸ë£¹(A), ë‹¨ì–´ë¥¼ ë§¤í•‘ëœ HASHê²°ê³¼(HASHê·¸ë£¹(B))ìœ¼ë¡œ ì¹˜í™˜í•´ì„œ ìƒê°í•´ë´…ì‹œë‹¤.

HASH ê²°ê³¼ë“¤ì„ ì¶•ì ì‹œí‚¨ ë°ì´í„°(ì‚¬ì „)ì„ ë§Œë“¤ì–´ë‘ë©´, íŠ¹ì •í•œ HASH ê²°ê³¼ê°€ ì–´ë–¤ ë¬¸ìì—´ë¡œë¶€í„° ë§¤í•‘ë˜ì—ˆëŠ”ì§€ ì•Œ ìˆ˜ ìˆì„ ê²ƒì…ë‹ˆë‹¤. 

ë³¸ ë¬¸ì œëŠ” 10000000~99999999ê°œì˜ ë°ì´í„°ë¥¼ ë§¤í•‘í•œ HASHê²°ê³¼ë¥¼ ë¬´ì‘ìœ„ë¡œ ì¶œë ¥í•˜ê³  ìˆìŠµë‹ˆë‹¤. ê·¸ë ‡ê¸° ë•Œë¬¸ì— ë‹¤ìŒê³¼ ê°™ì€ ë¡œì§(Logic)ìœ¼ë¡œ ë¬¸ì œë¥¼ í•´ê²°í•  ê²ƒì…ë‹ˆë‹¤.
1. `100000000salt_for_you`ë¶€í„° ì‹œì‘í•˜ì—¬ `99999999salt_for_you`ê¹Œì§€ì˜ ë¬¸ìì—´ì„ ëª¨ë‘ 500íšŒ sha1 HASH í•˜ì—¬ ê·¸ ë°ì´í„°ë¥¼ ì €ì¥í•œë‹¤. (=ì‚¬ìš©ì ì‚¬ì „)
2. ì´í›„ 4ë²ˆ ë¬¸ì œì˜ ë¬¸ìì—´(**target**)ì„ ì‚¬ìš©ì ì‚¬ì „ì—ì„œ ì°¾ëŠ”ë‹¤.
3. ìš°ë¦¬ëŠ” ì‚¬ì „ìœ¼ë¡œ ë¶€í„° ì–´ë–¤ ë¬¸ìê°€ ë§¤í•‘ë˜ì–´ **target**ì´ ë˜ì—ˆëŠ”ì§€ í™•ì¸ í•  ìˆ˜ ìˆë‹¤.

ë¬¸ì œë¥¼ í•´ê²° í•  ë¡œì§ì´ ì™„ì„±ë˜ì—ˆìŠµë‹ˆë‹¤. ì €ëŠ” `Python`ì„ í†µí•´ ì‚¬ìš©ì ì‚¬ì „ì„ êµ¬ì¶•í•˜ì˜€ìŠµë‹ˆë‹¤. 
~~~python
import hashlib

def sha(no):
    data = f"{no}salt_for_you"
    for i in range(0, 500):
        data = hashlib.sha1(data.encode('utf-8')).hexdigest()
    return data

f = open("dictionary.txt","w")
for i in range (10000000, 99999999):
    f.write(f"{i}: {sha(i)}\n")
f.close()
~~~
10000000salt_for_you ë¶€í„° ì°¨ê·¼ì°¨ê·¼ ì‚¬ì „ì´ ìƒì„±ë˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. 
![4_2](https://i.imgur.com/Zbymf7G.png)

## ë§ˆì¹˜ë©°
ìœ„ í’€ì´ëŠ” CPUì— í° ë¶€í•˜ë¥¼ ê²ë‹ˆë‹¤. ì €ëŠ” 20000000salt_for_you ì •ë„ ì—ì„œ ì‚¬ì „ ìƒì„±ì„ ë©ˆì¶”ê³  ë¬¸ì œë¥¼ í’€ì—ˆìŠµë‹ˆë‹¤. í™•ë¥ ì ìœ¼ë¡œ ì‚¬ì „ì— ìˆëŠ” ê°’ì´ ë‚˜ì˜¬ í™•ë¥ ì´ 10% ì •ë„ ë˜ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤. ì‹¤ì œë¡œ ì•½ 6íšŒ ì •ë„ì˜ ìƒˆë¡œê³ ì¹¨ ëì—, ì‚¬ì „ì— ìˆëŠ” 15486215salt_for_youê°€ ìºì¹˜ë˜ì–´ ë¬¸ì œë¥¼ í•´ê²°í–ˆìŠµë‹ˆë‹¤.

----

[^1]: mixed indicates that a parameter may accept multiple (but not necessarily all) types.

[^2]: í•´ì‹œ í•¨ìˆ˜(hash function)ëŠ” ì„ì˜ì˜ ê¸¸ì´ì˜ ë°ì´í„°ë¥¼ ê³ ì •ëœ ê¸¸ì´ì˜ ë°ì´í„°ë¡œ ë°”ê¾¸ëŠ”ë°, ì´ë¥¼ **ë§¤í•‘**ì´ë¼ê³  í•©ë‹ˆë‹¤.

<style>
blockquote{
    border-left: 0.25em solid #266477;
}
</style>
<style>
.page__content h1,
.page__content h2
{
    padding-bottom: 0.5em;
    border-bottom: 1px solid #89ddff;
}
</style>
<style>
    .PHP {
        display: inline;
            padding-left: 5px;
            padding-right: 5px;
            padding-top: 1px;
            padding-bottom: 2px;
            font-size: 0.6em;
            text-align: center;
            background-color: #777bb3;
            color: #f8fafc;
            border-top-left-radius: 3px;
            border-bottom-left-radius: 3px;
        }

        .PHPver {
            display: inline;
            padding-left: 5px;
            padding-right: 5px;
            padding-top: 1px;
            padding-bottom: 2px;
            font-size: 0.6em;
            text-align: center;
            background-color: #5c5c5c;
            color: #f8fafc;
            border-top-right-radius: 3px;
            border-bottom-right-radius: 3px;
        }
    </style>
<style>
    p{
        margin-block-start: 0em;
        margin-block-end: 0em;
        margin-inline-start: 0px;
        margin-inline-end: 0px;
        margin-top:0px;
        margin-bottom: 0px;
    }

    .Mysql{   
    display: inline;
    padding-left: 5px;
    padding-right: 5px;
    padding-top: 1px;
    padding-bottom: 2px;
    font-size: 0.6em;
    text-align: center;
    background-color: #097abb;
    color: #f8fafc;
    border-top-left-radius: 3px;
    border-bottom-left-radius: 3px;
    content: "MySQL"
}
    .Ver{
    display: inline;
    padding-left: 5px;
    padding-right: 5px;
    padding-top: 1px;
    padding-bottom: 2px;
    font-size: 0.6em;
    text-align: center;
    background-color: #5c5c5c;
    color: #f8fafc;
    border-top-right-radius: 3px;
    border-bottom-right-radius: 3px;
}
</style>


<style>
.page h1:before {
    padding-right: 0.3em;
    color: #9ddcff;
    content: "/";
}

.page h2:before {
    padding-right: 0.3em;
    color: #9ddcff;
    content: "//";
}

.page h3:before {
    padding-right: 0.3em;
    color: #9ddcff;
    content: "///";
}

.page h4:before {
    padding-right: 0.3em;
    color: #9ddcff;
    content: "////";
}

p>code,
a>code,
li>code,
figcaption>code,
td>code {
    padding-left: 0.18rem;
    padding-right: 0.18rem;
    padding-top: 0.09rem;
    font-size: 0.8em;
    background: #fff;
    color: #5283f3;
    border: solid 1px #e1e4e5;
    border-radius: 0px;
    font-family: open sans,clear sans,helvetica neue,Helvetica,Arial,sans-serif;
    font-weight: bold;
}
</style>
