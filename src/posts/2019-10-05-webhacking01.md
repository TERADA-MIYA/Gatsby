---
title: "webhacking.kr 1ë²ˆ ë¬¸ì œ"
date: 2019-10-05 15:12
categories: webhacking
excerpt: "Cookie injectionê³¼ php ê¸°ë³¸ ë¬¸ë²•"
comments: true
header:
  teaser: "https://raw.githubusercontent.com/TERADA-DANTE/TERADA-DANTE.github.io/master/_images/teaser/webhacking_teaser.jpg"
toc: true 
toc_label: "ì´ë²ˆ í¬ìŠ¤íŠ¸ì—ì„œëŠ” ..." 
toc_icon: "chess-rook"
toc_sticky: true
---

## ê°œìš”
> Simple is the best.

ê°„ë‹¨í•œ ê²ƒì´ ìµœê³ ë¼ëŠ” ë§ì´ ìˆì£ . ê°„ë‹¨í•˜ë‹¤ê³  í•´ì„œ ì¤‘ìš”í•˜ì§€ ì•Šì€ ê²ƒì€ ì•„ë‹™ë‹ˆë‹¤. ì˜¤íˆë ¤ ê°€ì¥ ì¤‘ìš”í• ì§€ë„ ëª¨ë¥´ì£ . 

ì´ë²ˆ PostëŠ” Webhacking.kr 1ë²ˆë¬¸ì œì— ê´€í•œ ê²ƒì…ë‹ˆë‹¤. ë‚œì´ë„ëŠ” ë‚®ì€í¸ì´ì§€ë§Œ 1ë²ˆë¬¸ì œë¥¼ í†µí•´ `Cookie injection`, `php`ë¬¸ë²•ì— ëŒ€í•œ ê¸°ì´ˆì ì¸ ê³µë¶€ë¥¼ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë°°ì ì€ 200ì ì…ë‹ˆë‹¤.

level 1ì˜ ì²« í˜ì´ì§€ëŠ” ë‹¤ìŒê³¼ ê°™ì´ ë˜ì–´ìˆìŠµë‹ˆë‹¤.

![Imgur](https://i.imgur.com/NLcyvSy.png)

view-sourceë¥¼ ëˆŒëŸ¬ ì†ŒìŠ¤ì½”ë“œğŸ§¾ë¥¼ í™•ì¸í•´ë´…ì‹œë‹¤.

`view-source`

~~~php
...
  if(!is_numeric($_COOKIE['user_lv'])) 
  $_COOKIE['user_lv']=1;
  if($_COOKIE['user_lv']>=6) 
  $_COOKIE['user_lv']=1;
  if($_COOKIE['user_lv']>5) solve(1);
  echo "<br>level : {$_COOKIE['user_lv']}";
...
~~~

**ë¬¸ì œì˜ ëª©í‘œ**ëŠ” line 6ì˜ solve(1)ì„ ì‹¤í–‰ì‹œí‚¤ëŠ” ê²ƒìœ¼ë¡œ ë³´ì…ë‹ˆë‹¤. ë¶„ì„ì—ì„œëŠ” [í’€ì´](#í’€ì´)ì— ì•ì„œ ì†ŒìŠ¤ì½”ë“œì— ì‚¬ìš©ëœ í•¨ìˆ˜ë“¤ì„ ì„¤ëª…í•©ë‹ˆë‹¤. 

## ë¶„ì„

### if
`if`ëŠ” ì¡°ê±´ë¬¸ì´ ì°¸ì¼ ë•Œ ì§€ì •ëœ ë‚´ìš©ì„ ì‹¤í–‰í•©ë‹ˆë‹¤. `if`ëŠ” ë‹¤ë¥¸ í”„ë¡œê·¸ë˜ë° ì–¸ì–´ì™€ í° ì°¨ì´ê°€ ì—†ê³ , ê·¸ ë¬¸ë²•ì´ ì–´ë µì§€ ì•Šìœ¼ë¯€ë¡œ ì„¤ëª…ì„ ìƒëµí•©ë‹ˆë‹¤.

### echo()

<a class="PHP">PHP</a><a class="PHPver">7.0</a>  

`echo` ëŠ” dataë¥¼ ì¶œë ¥í•©ë‹ˆë‹¤.
#### echo() ë¬¸ë²•
~~~~php
echo (string $arg1 [, string $...]);
~~~~
*Note*: [] is optional.
- `string $arg1` : ì¶œë ¥í•  ë¬¸ìì—´

#### echo() ì˜ˆì œ
~~~~php
  echo ("Welcome");             // Welcome
    
  $_greeting = "Hello";
  echo ("${_greeting} World!"); // Hello World!
  echo "I am", " ", 20+1;       // I am 21
~~~~
*Line 4*: ì¤‘ê´„í˜¸ ì†ì— `$`ê°€ ì—†ë‹¤ëŠ” ê²ƒì— ìœ ì˜í•˜ì.

### is_numeric()

<a class="PHP">PHP</a><a class="PHPver">7.0</a>  

`is_numeric()`ì€ ë°ì´í„°ê°€ numeric(`integer`,`double`, `float`)í•œì§€ë¥¼ í™•ì¸í•©ë‹ˆë‹¤.

#### is_numeric() ë¬¸ë²•
~~~~php
is_numeric($arg1);
~~~~

`Boolean`: ë°ì´í„°ê°€ numericí•œ ê²½ìš° `1(true)`ì„, ê·¸ë ‡ì§€ ì•Šì€ê²½ìš° `0(false)`ì„ ë°˜í™˜í•©ë‹ˆë‹¤.

#### is_numeric() ì˜ˆì œ
~~~php
$val = "string";
$val_2 = 2019;
$val_3 = 273.15;
  
  echo gettype($val);       // string
  echo is_numeric($val);    // 0
  echo gettype($val_2);     // integer
  echo is_numeric($val_2);  // 1
  echo gettype($val_3);     // double
  echo is_numeric($val_3);  // 1
~~~

*Line 5*: `gettype()`: ë°ì´í„°ì˜ ìë£Œí˜•ì„ ë°˜í™˜í•œë‹¤.

### $_COOKIE
`$_COOKIE['user_lv']`ì— ëŒ€í•´ ì„¤ëª…í•˜ê¸°ì— ì•ì„œ, phpì˜ ë°°ì—´(array)ì— ëŒ€í•´ ì´í•´í•´ì•¼ í•©ë‹ˆë‹¤. ë‹¤ìŒê³¼ ê°™ì€ ì˜ˆì œê°€ ìˆìŠµë‹ˆë‹¤.
#### php ë°°ì—´(Array) ì˜ˆì œ
~~~~php
$_agent = array(
    'name'=>'Terada',
    'age'=>20,
    "is_happy"=>true
);                        // ë°°ì—´ì˜ ì„ ì–¸

echo $_agent;             // Array
echo $_agent['name'];     // Terada
echo $_agent['age'];      // 20
echo $_agent['is_happy']; // 1
~~~~
*Line4, 10*: ë°°ì—´ì˜ ì„ ì–¸ê³¼ ì ‘ê·¼ì— `""`, `''`ëŠ” ë¬´ê´€í•©ë‹ˆë‹¤. í•˜ì§€ë§Œ í†µì¼í•´ì„œ ì‚¬ìš©í•˜ëŠ” ê²ƒì„ ê¶Œì¥í•©ë‹ˆë‹¤. 

ì¦‰, $_COOKIE['user_lv'] ì´ë€ _COOKIEë¼ëŠ” ë°°ì—´ì˜ 'user_lv' ì¸ì˜ìŠ¤(index)ì— ì ‘ê·¼í•˜ëŠ” ê²ƒì„ ëœ»í•©ë‹ˆë‹¤.

## í’€ì´
`view-source`ì˜ line 3, 4ëŠ” ë‹¤ìŒê³¼ ê°™ì´ í•´ì„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
~~~~php
if(!is_numeric($_COOKIE['user_lv'])) 
//$_COOKIEë¼ëŠ” Arrayì˜ user_lv ìš”ì†Œì— ì ‘ê·¼í•˜ì—¬ 
//ê·¸ dataê°€ numericí•˜ì§€ ì•Šì„ ê²½ìš°
  $_COOKIE['user_lv']=1;
//$_COOKIEì˜ user_lvì„ 1ë¡œ í•œë‹¤.
~~~~
í˜ì´ì§€ì˜ ì¿ í‚¤ğŸªë¥¼ í™•ì¸í•´ë³´ì•˜ìŠµë‹ˆë‹¤.

![Imgur](https://i.imgur.com/rz9SQUZ.png)

*Note*: ìœ„ Toolì€ Chrome Extension ğŸª[EditThisCookie](https://chrome.google.com/webstore/detail/editthiscookie/fngmhnnpilhplaeedifhccceomclgfbg?hl=ko)ì…ë‹ˆë‹¤.

user_lvì´ 1ë¡œ ë˜ì–´ìˆëŠ” ê²ƒì„ í™•ì¸ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.ì´ì–´ì„œ `view-source`ì˜ line 5~8ì„ í•´ì„í•´ë³´ë©´,
~~~~php
  if($_COOKIE['user_lv']>=6) 
  // user_lvì´ 6ë³´ë‹¤ í¬ê±°ë‚˜ ê°™ìœ¼ë©´ 
  $_COOKIE['user_lv']=1;
  // user_lvì„ 1ë¡œ ì´ˆê¸°í™”í•œë‹¤.
  if($_COOKIE['user_lv']>5) solve(1);
  // user_lvì´ 5ë³´ë‹¤ í¬ë©´ solve(1)ì„ ì‹¤í–‰í•œë‹¤.
~~~~
*Note*: `solve(1)`ì˜ ì‹¤í–‰ì´ 1ë²ˆë¬¸ì œì˜ clearë¥¼ ì˜ë¯¸í•©ë‹ˆë‹¤.

ë”°ë¼ì„œ ë‹¤ìŒ ì¡°ê±´ì„ ë§Œì¡±í•˜ëŠ” dataë¡œ $_Cookie[user_lv]ì„ ì„¤ì •í•´ì•¼í•©ë‹ˆë‹¤.
1. user_lvì´ numeric
2. user_lv > 5  
3. user_lv < 6

[ë¶„ì„](#ë¶„ì„)ì—ì„œ ì–¸ê¸‰í–ˆë“¯ì´ Numericí•œ ë°ì´í„°ì—ëŠ” `integer` ì´ì™¸ì—ë„ `double`, `float`ê°€ ìˆìŠµë‹ˆë‹¤. ë”°ë¼ì„œ ìœ„ ì¡°ê±´ë“¤ì„ ë§Œì¡±ì‹œí‚¤ëŠ” dataë¡œ (i.e. 5.5) user_lv ê°’ì„ ë³€ê²½í•˜ë©´ 1ë²ˆë¬¸ì œë¥¼ í´ë¦¬ì–´ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.ğŸ’¯

<style>
        .PHP {
            display: inline;
            padding-left: 5px;
            padding-right: 5px;
            padding-top: 1px;
            padding-bottom: 2px;
            font-size: 0.6em;
            text-align: center;
            background-color: #777bb3;
            color: #f8fafc;
            border-top-left-radius: 3px;
            border-bottom-left-radius: 3px;
            content: "MySQL"
        }

        .PHPver {
            display: inline;
            padding-left: 5px;
            padding-right: 5px;
            padding-top: 1px;
            padding-bottom: 2px;
            font-size: 0.6em;
            text-align: center;
            background-color: #000000c7;
            color: #f8fafc;
            border-top-right-radius: 3px;
            border-bottom-right-radius: 3px;
        }
</style>
<style>
.page h1:before {
    padding-right: 0.3em;
    color: #9ddcff;
    content: "/";
}

.page h2:before {
    padding-right: 0.3em;
    color: #9ddcff;
    content: "//";
}

.page h3:before {
    padding-right: 0.3em;
    color: #9ddcff;
    content: "///";
}

.page h4:before {
    padding-right: 0.3em;
    color: #9ddcff;
    content: "////";
}

p>code,
a>code,
li>code,
figcaption>code,
td>code {
    padding-left: 0.18rem;
    padding-right: 0.18rem;
    padding-top: 0.09rem;
    font-size: 0.8em;
    background: #fff;
    color: #5283f3;
    font-weight: bold;
    border: solid 1px #e1e4e5;
    border-radius: 0px;
    font-family: open sans,clear sans,helvetica neue,Helvetica,Arial,sans-serif;
}
</style>